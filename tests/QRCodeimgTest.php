<?php

namespace mad\otputil\tests;

use chillerlan\Authenticator\Base32;
use mad\otputil\models\Secret;
use mad\otputil\widgets\QRCodeimg;

class QRCodeimgTest extends TestCase
{
    // Tests:

    public function testGenerateQRCode()
    {
        $base32 = new Base32();
        $exp = '<img src="data:image/png;base64,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" alt="QRCode">';

        $s = new Secret();
        $s->secret = $base32->fromString('random');
        $s->digits = 6;
        $s->mode = 'totp';
        $s->algo = 'SHA1';
        $s->period = 30;
        $s->save();

        ob_start();
        $img = QRCodeimg::widget([
                    'sid' => $s->id,
                    'username' => 'foo',
                    'label' => 'bar'
                ]);
        ob_end_clean();

        $this->assertEquals($exp, $img);
    }
}
