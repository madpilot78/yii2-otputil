<?php

namespace mad\otputil\tests;

use chillerlan\Authenticator\Base32;
use mad\otputil\models\Secret;
use mad\otputil\widgets\QRCodeimg;

class QRCodeimgTest extends TestCase
{
    // Tests:

    public function testGenerateQRCode()
    {
        $base32 = new Base32();
        $exp = '<img src="data:image/png;base64,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" alt="QRCode">';

        $s = new Secret();
        $s->secret = $base32->fromString('random');
        $s->digits = 6;
        $s->mode = 'totp';
        $s->algo = 'SHA1';
        $s->period = 30;
        $s->save();

        ob_start();
        $img = QRCodeimg::widget([
                    'sid' => $s->id,
                    'username' => 'foo',
                    'label' => 'bar'
                ]);
        ob_end_clean();

        $this->assertEquals($exp, $img);
    }
}
